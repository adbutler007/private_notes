# Package Structure

The Audio Summary App now follows a proper Python package structure for better maintainability and distribution.

## Directory Structure

```
audio_summary_app/
├── pyproject.toml              # Project configuration (PEP 518/621)
├── .python-version             # Python version for uv
├── requirements.txt            # Dependencies (for pip users)
├── uv.lock                     # Lockfile (generated by uv sync)
│
├── run.py                      # Quick launcher: python run.py
├── run_demo.py                 # Demo launcher: python run_demo.py
│
├── src/                        # Source code (src-layout)
│   └── audio_summary_app/      # Main package
│       ├── __init__.py         # Package exports
│       ├── __main__.py         # CLI entry point
│       ├── config.py           # Configuration
│       ├── audio_capture.py    # Audio capture
│       ├── transcriber.py      # Speech-to-text
│       ├── transcript_buffer.py # Transcript storage
│       ├── summarizer.py       # Summarization
│       └── demo.py             # Demo mode
│
├── docs/                       # Documentation
│   ├── README.md               # Main README
│   ├── SETUP.md                # Quick setup guide
│   ├── ARCHITECTURE.md         # System architecture
│   ├── DATA_FLOW.md           # Privacy architecture
│   ├── INSTALL.md             # Detailed installation
│   ├── INSTALL_UV.md          # UV-specific installation
│   ├── UV_MIGRATION.md        # Migration guide
│   ├── CHANGELOG.md           # Version history
│   └── PACKAGE_STRUCTURE.md   # This file
│
├── summaries/                  # Output directory (created at runtime)
└── demo_output/                # Demo output (created when demo runs)
```

## Package Layout Benefits

### 1. **Src Layout**
The `src/` layout prevents accidental imports from the project root, ensuring tests run against the installed package.

### 2. **Proper Package**
All code is in `audio_summary_app/` package, making imports consistent:
```python
from audio_summary_app import Config, AudioCaptureManager
```

### 3. **Entry Points**
The package defines CLI entry points in `pyproject.toml`:
```toml
[project.scripts]
audio-summary = "audio_summary_app.__main__:main"
audio-summary-demo = "audio_summary_app.demo:main"
```

After installation, you can run:
```bash
audio-summary        # Main application
audio-summary-demo   # Demo mode
```

### 4. **Module Execution**
You can also run the package as a module:
```bash
python -m audio_summary_app        # Main application
python -m audio_summary_app.demo   # Demo mode
```

## Usage

### Installation

```bash
# Clone/download the project
cd audio_summary_app

# Install with uv (recommended)
uv sync

# Or install with pip
pip install -e .
```

### Running

**Method 1: Use convenience scripts**
```bash
python run.py       # Main app
python run_demo.py  # Demo
```

**Method 2: Use installed CLI commands**
```bash
audio-summary       # Main app
audio-summary-demo  # Demo
```

**Method 3: Run as module**
```bash
python -m audio_summary_app        # Main app
python -m audio_summary_app.demo   # Demo
```

**Method 4: Use uv run**
```bash
uv run python run.py              # Main app
uv run python run_demo.py         # Demo
uv run python -m audio_summary_app # Main app
```

## Import Structure

The package follows a clean import hierarchy:

```python
# Top-level package exports the main classes
from audio_summary_app import (
    Config,
    AudioCaptureManager,
    StreamingTranscriber,
    TranscriptBuffer,
    MapReduceSummarizer,
)

# Or import from submodules directly
from audio_summary_app.config import Config
from audio_summary_app.transcriber import StreamingTranscriber
```

## Module Descriptions

### `__init__.py`
- Package initialization
- Exports main classes
- Defines `__version__` and `__author__`

### `__main__.py`
- Main CLI application
- AudioSummaryApp class
- Threading and queue management
- Audio → Transcription → Summary pipeline

### `demo.py`
- Demo mode without audio hardware
- Mock transcription simulation
- Privacy comparison display

### `config.py`
- Configuration dataclass
- Model settings
- Setup instructions

### `audio_capture.py`
- Audio input/output capture
- Platform-specific audio handling
- Stream management

### `transcriber.py`
- OpenAI Whisper integration
- Real-time speech-to-text
- Audio buffering

### `transcript_buffer.py`
- Circular buffer for transcripts
- In-memory storage
- Chunk management

### `summarizer.py`
- Ollama integration
- Map-reduce summarization
- Rolling and final summaries

## Development

### Install with dev dependencies
```bash
uv sync --group dev
```

### Run tests
```bash
pytest
```

### Format code
```bash
black src/
ruff check src/
```

### Type check
```bash
mypy src/
```

## Building and Distribution

### Build wheel
```bash
uv build
```

### Install from wheel
```bash
pip install dist/audio_summary_app-2.0.0-py3-none-any.whl
```

### Upload to PyPI (future)
```bash
twine upload dist/*
```

## Migration from Old Structure

The old structure had all `.py` files at the root:
```
audio_summary_app/
├── main.py
├── demo.py
├── config.py
├── transcriber.py
└── ...
```

The new structure is backwards compatible through:
1. Wrapper scripts (`run.py`, `run_demo.py`)
2. Imports work the same after installation
3. Configuration and data directories unchanged

## Why This Structure?

### Advantages

1. **Standard Python Packaging** - Follows PEP 518/621/660
2. **Better Imports** - No namespace pollution
3. **Easier Testing** - Test against installed package
4. **Distribution Ready** - Can publish to PyPI
5. **IDE Support** - Better code completion and navigation
6. **Editable Install** - `pip install -e .` works correctly

### Trade-offs

- Slightly deeper directory nesting
- Need to understand package imports
- More files to manage

### Best for

- ✅ Production deployments
- ✅ Team collaboration
- ✅ Package distribution
- ✅ Long-term maintenance

## Old Files (Kept for Reference)

The old structure files are preserved at the root for reference:
- `main.py` → Use `run.py` or `audio-summary`
- `demo.py` → Use `run_demo.py` or `audio-summary-demo`
- `config.py`, etc. → Now in `src/audio_summary_app/`

You can safely delete these after verifying the new structure works for your use case.

## Questions?

- **Where's the code?** → `src/audio_summary_app/`
- **How do I run it?** → `python run.py` or `audio-summary`
- **How do I import?** → `from audio_summary_app import Config`
- **Where are summaries saved?** → `./summaries/` (unchanged)
- **Old files?** → Can be deleted after testing

---

**Next Steps:** See [SETUP.md](SETUP.md) for installation instructions.
